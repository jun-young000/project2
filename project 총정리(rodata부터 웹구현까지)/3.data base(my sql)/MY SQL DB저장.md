```sql
#db에 저장하기


ERROR 3948 (42000): Loading local data is disabled; this must be enabled on both the client and server sides  

해결방법
mysql> show global variables like 'local_infile';

입력하면
+---------------+-------+
| Variable_name | Value |
+---------------+-------+
| local_infile  |  OFF  |
+---------------+-------+
mysql> set global local_infile=true;
이걸 입력하면 OFF 가  ON으로 바뀐다

mysql> exit
mysql --local_infile -u root -p

CREATE TABLE date(기간코드 VARCHAR(30), 기간 VARCHAR(30));

LOAD DATA LOCAL INFILE '/home/engineer/서울시_5대범죄_현황1.csv/seoul_crime.csv.csv'
INTO TABLE date
FIELDS TERMINATED BY ',';


에러가 발생해서 기간코드 파일의 컬럼명을 삭제하고 다시 시도해보기로 함
import pyspark.sql.functions as F
a.filter(a.col("rownumber").between(2,4)).show()
```



```
#db에 넣기 위해 컬럼명 삭제
a = spark.read.format("csv").load("새폴더/서울시_행정코드.csv")
컬럼명 삭제를 위해 header 지정 없이 csv를 불러옴

a.where( col("_c0")!=("ID")).show()
거의 모든 df들이 가지고 있는 기간코드라는 컬럼명을 조건에 이용하여 해당 문자열을 가진 행을 삭제하는 방식 사용

a.coalesce(1).write.format("csv").mode("overwrite").save("/user/engineer/서울시_지역코드1.csv")

만일의 상황에 대비하여 원래 컬럼명 백업
5대범죄 - id 기간코드 지역코드 합계 살인 강도 강간강제추행 절도 폭력
경찰관 현황 - id 기간코드 경찰서명 인원수
씨씨티비 - id 기간코드 지역코드 개수
```

```sql
##데이터 db에 저장하는 코드
#기간코드
CREATE TABLE DATE(
DATE_CODE INT PRIMARY KEY,
DATE INT );
LOAD DATA LOCAL INFILE '/home/ubuntu/DB/date_code.csv'
INTO TABLE DATE
FIELDS TERMINATED BY ',';

#지역코드
CREATE TABLE LOCATION(
LOCAL_CODE INT PRIMARY KEY,
LOCAL_NAME VARCHAR(5)
);

LOAD DATA LOCAL INFILE '/home/ubuntu/DB/loc_code.csv'
INTO TABLE LOCATION
FIELDS TERMINATED BY ',';

#5대범죄
CREATE TABLE 5_CRIME_RATES(
ID INT PRIMARY KEY,
DATE_CODE INT ,
LOCAL_CODE INT ,
TOTAL INT,
MURDER INT,
ROBBER INT,
MOLEST INT,
THEFT INT,
VIOLENCE INT
);

CREATE TABLE 5_CRIME_RATES(
ID INT PRIMARY KEY,
DATE_CODE INT,
LOCAL_CODE INT,
TOTAL INT,
MURDER INT,
ROBBER INT,
MOLEST INT,
THEFT INT,
VIOLENCE INT,
FOREIGN KEY(DATE_CODE) REFERENCES DATE(DATE_CODE)
);

LOAD DATA LOCAL INFILE '/home/ubuntu/DB/seoul_crime.csv'
INTO TABLE 5_CRIME_RATES
FIELDS TERMINATED BY ',';

alter table 5_CRIME_RATES add FOREIGN KEY(LOCAL_CODE) REFERENCES LOCATION(LOCAL_CODE);


select * from information_schema.table_constraints where table_name = '5_CRIME_RATES';
SELECT * FROM information_schema.table_constraints;



#유동인구 
CREATE TABLE FLOATING_POP(
ID INT PRIMARY KEY,
DATE_CODE INT,
LOCAL_CODE INT,
TOTAL INT,
MAX_DAY INT,
MIN_DAY INT,
DAY_TIME INT,
NIGHT_TIME INT,
MAX_MOVE_PEOPLE INT,
LOCAL_MOVE_PEOPLE INT,
FOREIGN KEY(DATE_CODE) REFERENCES DATE(DATE_CODE),
FOREIGN KEY(LOCAL_CODE) REFERENCES LOCATION(LOCAL_CODE)
);



LOAD DATA LOCAL INFILE '/home/ubuntu/DB/move.csv'
INTO TABLE FLOATING_POP
FIELDS TERMINATED BY ',';

#유흥업소
CREATE TABLE KARAOKE(
ID INT PRIMARY KEY,
LOCAL_CODE INT,
DATE_CODE INT,
AUTH_DATE INT,
ADDR VARCHAR(40),
FOREIGN KEY(DATE_CODE) REFERENCES DATE(DATE_CODE),
FOREIGN KEY(LOCAL_CODE) REFERENCES LOCATION(LOCAL_CODE)
);

LOAD DATA LOCAL INFILE '/home/ubuntu/DB/karaoke.csv'
INTO TABLE KARAOKE
FIELDS TERMINATED BY ',';



#인구밀도
CREATE TABLE POPULATION_DENSITY(
ID INT PRIMARY KEY,
DATE_CODE INT,
LOCAL_CODE INT,
POPULATION INT,
AREA INT,
DENSITY INT,
FOREIGN KEY(DATE_CODE) REFERENCES DATE(DATE_CODE),
FOREIGN KEY(LOCAL_CODE) REFERENCES LOCATION(LOCAL_CODE)
    
);

LOAD DATA LOCAL INFILE '/home/ubuntu/DB/pop_den1.csv'
INTO TABLE POPULATION_DENSITY
FIELDS TERMINATED BY ',';

#공시지가
CREATE TABLE OFFICIAL_PRICE(
ID INT PRIMARY KEY,
LOCAL_CODE INT,
DATE_CODE INT,
PRICE INT,
FOREIGN KEY(DATE_CODE) REFERENCES DATE(DATE_CODE),
FOREIGN KEY(LOCAL_CODE) REFERENCES LOCATION(LOCAL_CODE)
);
LOAD DATA LOCAL INFILE '/home/ubuntu/DB/official_price.csv'
INTO TABLE OFFICIAL_PRICE
FIELDS TERMINATED BY ',';


#cctv
CREATE TABLE CCTV(
ID INT PRIMARY KEY,
DATE_CODE INT,
LOCAL_CODE INT,
TOTAL INT,
FOREIGN KEY(DATE_CODE) REFERENCES DATE(DATE_CODE),
FOREIGN KEY(LOCAL_CODE) REFERENCES LOCATION(LOCAL_CODE)
);

LOAD DATA LOCAL INFILE '/home/ubuntu/DB/cctv.csv'
INTO TABLE CCTV
FIELDS TERMINATED BY ',';

#경찰관
CREATE TABLE POLICE_OFFICE(
ID INT PRIMARY KEY,
DATE_CODE INT,
LOCAL_CODE INT,
COP INT,
POLICE_BOX INT,
FOREIGN KEY(DATE_CODE) REFERENCES DATE(DATE_CODE),
FOREIGN KEY(LOCAL_CODE) REFERENCES LOCATION(LOCAL_CODE)
);

LOAD DATA LOCAL INFILE '/home/ubuntu/DB/police_info.csv'
INTO TABLE POLICE_OFFICE
FIELDS TERMINATED BY ',';


ID,기간코드,지역코드,sum(경찰관수),sum(total)

#성비 다시 보기
CREATE TABLE GENDER(
ID INT PRIMARY KEY,
DATE_CODE INT,
LOCAL_CODE INT,
RATES FLOAT,
MALE INT,
FEMALE INT,
FOREIGN KEY(DATE_CODE) REFERENCES DATE(DATE_CODE),
FOREIGN KEY(LOCAL_CODE) REFERENCES LOCATION(LOCAL_CODE)
);

LOAD DATA LOCAL INFILE '/home/ubuntu/DB/gender.csv'
INTO TABLE GENDER
FIELDS TERMINATED BY ',';


#서울시 노후건물 

CREATE TABLE OLD_BUILDING(
ID INT PRIMARY KEY,
DATE_CODE INT,
LOCAL_CODE INT,
TOTAL_OVER_20 INT,
HOUSE_OVER_20 INT,
APT_OVER_20 INT,
ROW_HOUSE_OVER_20 INT,
MULTY_FAMILY_HOUSE_OVER_20 INT,
NON_LIVING_BUILDING_HOUSE_OVER_20 INT,
TOTAL_OVAL_30 INT,
HOUSE_OVER_30 INT,
APT_OVER_30 INT,
ROW_HOUSE_OVER_30 INT,
MULTY_FAMILY_HOUSE_OVER_30 INT,
NON_LIVING_BUILDING_HOUSE_OVER_30 INT,
FOREIGN KEY(DATE_CODE) REFERENCES DATE(DATE_CODE),
FOREIGN KEY(LOCAL_CODE) REFERENCES LOCATION(LOCAL_CODE)
);

LOAD DATA LOCAL INFILE '/home/ubuntu/DB/old_bilding.csv' INTO TABLE OLD_BUILDING FIELDS TERMINATED BY ',';

#1인가구
CREATE TABLE FEMALE_SINGLE_HOUSE(
ID INT PRIMARY KEY,
DATE_CODE INT,
LOCAL_CODE INT,
TOTAL INT,
UNDER_20 INT,
20_24 INT,
25_29 INT,
30_34 INT,
35_39 INT,
40_44 INT,
45_49 INT,
50_59 INT,
60_64 INT,
65_69 INT,
70_74 INT,
75_79 INT,
80_84 INT,
OVER_85 INT,
FOREIGN KEY(DATE_CODE) REFERENCES DATE(DATE_CODE),
FOREIGN KEY(LOCAL_CODE) REFERENCES LOCATION(LOCAL_CODE)
);

LOAD DATA LOCAL INFILE '/home/ubuntu/DB/single_house.csv'
INTO TABLE FEMALE_SINGLE_HOUSE
FIELDS TERMINATED BY ',';

#외국인
CREATE TABLE FOREIGNERS(
ID INT PRIMARY KEY,
DATE_CODE INT,
LOCAL_CODE INT,
TOTAL INT,
FORIGNER INT,
FOREIGN KEY(DATE_CODE) REFERENCES DATE(DATE_CODE),
FOREIGN KEY(LOCAL_CODE) REFERENCES LOCATION(LOCAL_CODE)
);

LOAD DATA LOCAL INFILE '/home/ubuntu/DB/forigner.csv'
INTO TABLE FOREIGNERS
FIELDS TERMINATED BY ',';

#검거율
CREATE TABLE 5_CRIME_ARREST(
ID INT PRIMARY KEY,
DATE_CODE INT,
LOCAL_CODE INT,
TOTAL INT,
MURDER INT,
ROBBER INT,
MOLEST INT,
THEFT INT,
VIOLENCE INT,
FOREIGN KEY(DATE_CODE) REFERENCES DATE(DATE_CODE),
FOREIGN KEY(LOCAL_CODE) REFERENCES LOCATION(LOCAL_CODE)
);

LOAD DATA LOCAL INFILE '/home/ubuntu/DB/seoul_arrest.csv'
INTO TABLE 5_CRIME_ARREST
FIELDS TERMINATED BY ',';

#주거비율
CREATE TABLE BUILDING_TYPE(
ID INT PRIMARY KEY,
LOCAL_CODE INT,
ETC INT,
OFFICE INT,
STORE INT,
HOUSE INT,
FOREIGN KEY(LOCAL_CODE) REFERENCES LOCATION(LOCAL_CODE)
);

LOAD DATA LOCAL INFILE '/home/ubuntu/DB/building_type.csv'
INTO TABLE BUILDING_TYPE
FIELDS TERMINATED BY ',';

ID,지역코드,기타,사무,상가,주거,주거비율
```



```sql
#db에 저장된 data를 csv로 불러오기
SELECT @@GLOBAL.secure_file_priv;

SELECT DATE,LOCAL_NAME,POPULATION,AREA,DENSITY  FROM POPULATION_DENSITY A JOIN LOCATION B ON A.LOCAL_CODE = B.LOCAL_CODE JOIN DATE C ON A.DATE_CODE = C.DATE_CODE
INTO OUTFILE '/var/lib/mysql-files/TEST.csv'
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\r\n';


```

"경찰서","기간코드","경찰관수","지구대","파출소","치안센터","지역코드"

